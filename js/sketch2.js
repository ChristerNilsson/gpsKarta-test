// Generated by CoffeeScript 2.5.1
var SCALE, VERSION, cx, cy, data, draw, f, img, index, initSpeaker, mapName, messages, preload, released, say, setup, speaker, start, startX, startY, state, timer, touchEnded, touchMoved, touchStarted;

VERSION = 101;

released = true;

mapName = ""; // t ex skarpnÃ¤ck

start = new Date();

state = 0; // 0=uninitialized 1=normal 2=info

data = null;

img = null;

startX = 0;

startY = 0;

messages = [];

index = 0;

speaker = null;

timer = null;

[cx, cy] = [
  0,
  0 // center (image coordinates)
];

SCALE = 1;

preload = function() {
  mapName = "2023-SommarS";
  return loadJSON(`data/${mapName}.json`, function(json) {
    var control, key, ref;
    data = json;
    ref = data.controls;
    for (key in ref) {
      control = ref[key];
      control.push("");
      control.push(0);
      control.push(0);
    }
    return img = loadImage("data/" + data.map);
  });
};

setup = function() {
  var canvas;
  canvas = createCanvas(innerWidth - 0.0, innerHeight); //-0.5
  canvas.position(0, 0); // hides text field used for clipboard copy.
  SCALE = data.scale;
  [cx, cy] = [img.width / 2, img.height / 2];
  return initSpeaker();
};

draw = function() {
  var i, j, len, ref, results, x, y;
  background(0, 255, 0);
  if (state === 0) {
    textSize(100);
    textAlign(CENTER, CENTER);
    x = width / 2;
    y = height / 2;
    text(mapName, x, y - 100);
    text('Version: ' + VERSION, x, y);
    text("Click to continue!", x, y + 200);
    return;
  }
  if (state === 1) {
    start = new Date();
    push();
    translate(width / 2, height / 2);
    scale(SCALE);
    image(img, round(-cx), round(-cy));
    pop();
    textSize(20);
    messages.push(round(frameRate()));
    ref = range(messages.length);
    //if messages.length > 50 then messages.shift()
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      if (i < messages.length - 50) {
        continue;
      }
      results.push(text(messages[i], 50, 20 + 20 * (i % 50)));
    }
    return results;
  }
};

touchStarted = function(event) {
  event.preventDefault();
  if (!released) {
    return;
  }
  //speed = 1
  released = false;
  startX = mouseX;
  startY = mouseY;
  return false;
};

touchMoved = function(event) {
  event.preventDefault();
  if (state === 1) {
    cx += (startX - mouseX) / SCALE;
    cy += (startY - mouseY) / SCALE;
    startX = mouseX;
    startY = mouseY;
  }
  return false;
};

touchEnded = function(event) {
  event.preventDefault();
  //say index
  //index++
  if (released) {
    return;
  }
  //initSpeaker() 
  released = true;
  if (state === 0 || state === 2) {
    state = 1;
    return false;
  }
  return false;
};

initSpeaker = function() {
  speaker = new SpeechSynthesisUtterance();
  speaker.voiceURI = "native";
  speaker.volume = 1;
  speaker.rate = 1.0;
  speaker.pitch = 0;
  speaker.text = '';
  speaker.lang = 'en-GB';
  //say "initspeaker"
  return f();
};

f = () => {
  say(index);
  console.log(index);
  index += 1;
  return setTimeout(f, 1000);
};

//setTimer = (ms) -> setTimeout f,ms
say = function(m) {
  if (speaker === null) {
    return;
  }
  speechSynthesis.cancel();
  speaker.text = m;
  return speechSynthesis.speak(speaker);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoMi5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXMiOlsiY29mZmVlXFxza2V0Y2gyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLFVBQUEsRUFBQTs7QUFBQSxPQUFBLEdBQVU7O0FBRVYsUUFBQSxHQUFXOztBQUNYLE9BQUEsR0FBVSxHQUhWOztBQUtBLEtBQUEsR0FBUSxJQUFJLElBQUosQ0FBQTs7QUFFUixLQUFBLEdBQVEsRUFQUjs7QUFTQSxJQUFBLEdBQU87O0FBRVAsR0FBQSxHQUFNOztBQUVOLE1BQUEsR0FBUzs7QUFDVCxNQUFBLEdBQVM7O0FBRVQsUUFBQSxHQUFXOztBQUNYLEtBQUEsR0FBUTs7QUFFUixPQUFBLEdBQVU7O0FBQ1YsS0FBQSxHQUFROztBQUVSLENBQUMsRUFBRCxFQUFJLEVBQUosQ0FBQSxHQUFVO0VBQUMsQ0FBRDtFQUFHLENBQUg7OztBQUNWLEtBQUEsR0FBUTs7QUFFUixPQUFBLEdBQVUsUUFBQSxDQUFBLENBQUE7RUFDVCxPQUFBLEdBQVU7U0FDVixRQUFBLENBQVMsQ0FBQSxLQUFBLENBQUEsQ0FBUSxPQUFSLENBQUEsS0FBQSxDQUFULEVBQWlDLFFBQUEsQ0FBQyxJQUFELENBQUE7QUFDbEMsUUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBO0lBQUUsSUFBQSxHQUFPO0FBQ1A7SUFBQSxLQUFBLFVBQUE7O01BQ0MsT0FBTyxDQUFDLElBQVIsQ0FBYSxFQUFiO01BQ0EsT0FB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RUFDWixLQUFLLENBQUMsY0FBTixDQUFBLEVBQUQ7OztFQUdDLElBQUcsUUFBSDtBQUFpQixXQUFqQjtHQUhEOztFQUtDLFFBQUEsR0FBVztFQUNYLElBQUcsVUFBVSxLQUFWLFVBQVksQ0FBZjtJQUNDLEtBQUEsR0FBUTtBQUNSLFdBQU8sTUFGUjs7U0FHQTtBQVZZOztBQVliLFdBQUEsR0FBYyxRQUFBLENBQUEsQ0FBQTtFQUNiLE9BQUEsR0FBVSxJQUFJLHdCQUFKLENBQUE7RUFDVixPQUFPLENBQUMsUUFBUixHQUFtQjtFQUNuQixPQUFPLENBQUMsTUFBUixHQUFpQjtFQUNqQixPQUFPLENBQUMsSUFBUixHQUFlO0VBQ2YsT0FBTyxDQUFDLEtBQVIsR0FBZ0I7RUFDaEIsT0FBTyxDQUFDLElBQVIsR0FBZTtFQUNmLE9BQU8sQ0FBQyxJQUFSLEdBQWUsUUFOaEI7O1NBUUMsQ0FBQSxDQUFBO0FBVGE7O0FBV2QsQ0FBQSxHQUFJLENBQUEsQ0FBQSxHQUFBO0VBQ0gsR0FBQSxDQUFJLEtBQUo7RUFDQSxPQUFPLENBQUMsR0FBUixDQUFZLEtBQVo7RUFDQSxLQUFBLElBQVM7U0FDVCxVQUFBLENBQVcsQ0FBWCxFQUFhLElBQWI7QUFKRyxFQWpISjs7O0FBeUhBLEdBQUEsR0FBTSxRQUFBLENBQUMsQ0FBRCxDQUFBO0VBQ0wsSUFBRyxPQUFBLEtBQVcsSUFBZDtBQUF3QixXQUF4Qjs7RUFDQSxlQUFlLENBQUMsTUFBaEIsQ0FBQTtFQUNBLE9BQU8sQ0FBQyxJQUFSLEdBQWU7U0FDZixlQUFlLENBQUMsS0FBaEIsQ0FBc0IsT0FBdEI7QUFKSyIsInNvdXJjZXNDb250ZW50IjpbIlZFUlNJT04gPSAxMDFcclxuXHJcbnJlbGVhc2VkID0gdHJ1ZVxyXG5tYXBOYW1lID0gXCJcIiAjIHQgZXggc2thcnBuw6Rja1xyXG5cclxuc3RhcnQgPSBuZXcgRGF0ZSgpXHJcblxyXG5zdGF0ZSA9IDAgIyAwPXVuaW5pdGlhbGl6ZWQgMT1ub3JtYWwgMj1pbmZvXHJcblxyXG5kYXRhID0gbnVsbFxyXG5cclxuaW1nID0gbnVsbFxyXG5cclxuc3RhcnRYID0gMFxyXG5zdGFydFkgPSAwXHJcblxyXG5tZXNzYWdlcyA9IFtdXHJcbmluZGV4ID0gMFxyXG5cclxuc3BlYWtlciA9IG51bGxcclxudGltZXIgPSBudWxsXHJcblxyXG5bY3gsY3ldID0gWzAsMF0gIyBjZW50ZXIgKGltYWdlIGNvb3JkaW5hdGVzKVxyXG5TQ0FMRSA9IDFcclxuXHJcbnByZWxvYWQgPSAtPlxyXG5cdG1hcE5hbWUgPSBcIjIwMjMtU29tbWFyU1wiXHJcblx0bG9hZEpTT04gXCJkYXRhLyN7bWFwTmFtZX0uanNvblwiLCAoanNvbikgLT5cclxuXHRcdGRhdGEgPSBqc29uXHJcblx0XHRmb3Iga2V5LGNvbnRyb2wgb2YgZGF0YS5jb250cm9sc1xyXG5cdFx0XHRjb250cm9sLnB1c2ggXCJcIlxyXG5cdFx0XHRjb250cm9sLnB1c2ggMFxyXG5cdFx0XHRjb250cm9sLnB1c2ggMFxyXG5cdFx0aW1nID0gbG9hZEltYWdlIFwiZGF0YS9cIiArIGRhdGEubWFwXHJcblxyXG5zZXR1cCA9IC0+XHJcblx0Y2FudmFzID0gY3JlYXRlQ2FudmFzIGlubmVyV2lkdGgtMC4wLCBpbm5lckhlaWdodCAjLTAuNVxyXG5cdGNhbnZhcy5wb3NpdGlvbiAwLDAgIyBoaWRlcyB0ZXh0IGZpZWxkIHVzZWQgZm9yIGNsaXBib2FyZCBjb3B5LlxyXG5cclxuXHRTQ0FMRSA9IGRhdGEuc2NhbGVcclxuXHJcblx0W2N4LGN5XSA9IFtpbWcud2lkdGgvMixpbWcuaGVpZ2h0LzJdXHJcblxyXG5cdGluaXRTcGVha2VyKClcclxuXHJcbmRyYXcgPSAtPlxyXG5cclxuXHRiYWNrZ3JvdW5kIDAsMjU1LDBcclxuXHRpZiBzdGF0ZSA9PSAwIFxyXG5cdFx0dGV4dFNpemUgMTAwXHJcblx0XHR0ZXh0QWxpZ24gQ0VOVEVSLENFTlRFUlxyXG5cdFx0eCA9IHdpZHRoLzJcclxuXHRcdHkgPSBoZWlnaHQvMiBcclxuXHRcdHRleHQgbWFwTmFtZSwgeCx5LTEwMFxyXG5cdFx0dGV4dCAnVmVyc2lvbjogJytWRVJTSU9OLCB4LHlcclxuXHRcdHRleHQgXCJDbGljayB0byBjb250aW51ZSFcIiwgeCx5KzIwMFxyXG5cdFx0cmV0dXJuXHJcblxyXG5cdGlmIHN0YXRlID09IDFcclxuXHRcdHN0YXJ0ID0gbmV3IERhdGUoKVxyXG5cdFx0cHVzaCgpXHJcblx0XHR0cmFuc2xhdGUgd2lkdGgvMiwgaGVpZ2h0LzJcclxuXHRcdHNjYWxlIFNDQUxFXHJcblx0XHRpbWFnZSBpbWcsIHJvdW5kKC1jeCkscm91bmQoLWN5KVxyXG5cdFx0cG9wKClcclxuXHRcdHRleHRTaXplIDIwXHJcblx0XHRtZXNzYWdlcy5wdXNoIHJvdW5kIGZyYW1lUmF0ZSgpXHJcblx0XHQjaWYgbWVzc2FnZXMubGVuZ3RoID4gNTAgdGhlbiBtZXNzYWdlcy5zaGlmdCgpXHJcblx0XHRmb3IgaSBpbiByYW5nZSBtZXNzYWdlcy5sZW5ndGhcclxuXHRcdFx0aWYgaSA8IG1lc3NhZ2VzLmxlbmd0aCAtIDUwIHRoZW4gY29udGludWVcclxuXHRcdFx0dGV4dCBtZXNzYWdlc1tpXSwgNTAsMjAgKyAyMCooaSAlIDUwKVxyXG5cclxudG91Y2hTdGFydGVkID0gKGV2ZW50KSAtPlxyXG5cdGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuXHRpZiBub3QgcmVsZWFzZWQgdGhlbiByZXR1cm5cclxuXHQjc3BlZWQgPSAxXHJcblx0cmVsZWFzZWQgPSBmYWxzZVxyXG5cdHN0YXJ0WCA9IG1vdXNlWFxyXG5cdHN0YXJ0WSA9IG1vdXNlWVxyXG5cdGZhbHNlXHJcblxyXG50b3VjaE1vdmVkID0gKGV2ZW50KSAtPlxyXG5cdGV2ZW50LnByZXZlbnREZWZhdWx0KClcclxuXHRpZiBzdGF0ZSA9PSAxXHJcblx0XHRjeCArPSAoc3RhcnRYIC0gbW91c2VYKS9TQ0FMRVxyXG5cdFx0Y3kgKz0gKHN0YXJ0WSAtIG1vdXNlWSkvU0NBTEVcclxuXHRcdHN0YXJ0WCA9IG1vdXNlWFxyXG5cdFx0c3RhcnRZID0gbW91c2VZXHJcblx0ZmFsc2VcclxuXHJcbnRvdWNoRW5kZWQgPSAoZXZlbnQpIC0+XHJcblx0ZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG5cdCNzYXkgaW5kZXhcclxuXHQjaW5kZXgrK1xyXG5cdGlmIHJlbGVhc2VkIHRoZW4gcmV0dXJuXHJcblx0I2luaXRTcGVha2VyKCkgXHJcblx0cmVsZWFzZWQgPSB0cnVlXHJcblx0aWYgc3RhdGUgaW4gWzAsMl1cclxuXHRcdHN0YXRlID0gMVxyXG5cdFx0cmV0dXJuIGZhbHNlXHJcblx0ZmFsc2VcclxuXHJcbmluaXRTcGVha2VyID0gLT5cclxuXHRzcGVha2VyID0gbmV3IFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSgpXHJcblx0c3BlYWtlci52b2ljZVVSSSA9IFwibmF0aXZlXCJcclxuXHRzcGVha2VyLnZvbHVtZSA9IDFcclxuXHRzcGVha2VyLnJhdGUgPSAxLjBcclxuXHRzcGVha2VyLnBpdGNoID0gMFxyXG5cdHNwZWFrZXIudGV4dCA9ICcnIFxyXG5cdHNwZWFrZXIubGFuZyA9ICdlbi1HQidcclxuXHQjc2F5IFwiaW5pdHNwZWFrZXJcIlxyXG5cdGYoKVxyXG5cclxuZiA9ICgpID0+XHJcblx0c2F5IGluZGV4XHJcblx0Y29uc29sZS5sb2cgaW5kZXhcclxuXHRpbmRleCArPSAxXHJcblx0c2V0VGltZW91dCBmLDEwMDBcclxuXHJcbiNzZXRUaW1lciA9IChtcykgLT4gc2V0VGltZW91dCBmLG1zXHJcblxyXG5zYXkgPSAobSkgLT5cclxuXHRpZiBzcGVha2VyID09IG51bGwgdGhlbiByZXR1cm5cclxuXHRzcGVlY2hTeW50aGVzaXMuY2FuY2VsKClcclxuXHRzcGVha2VyLnRleHQgPSBtXHJcblx0c3BlZWNoU3ludGhlc2lzLnNwZWFrIHNwZWFrZXJcclxuIl19
//# sourceURL=c:\github\gpsKarta-test\coffee\sketch2.coffee